
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
 	    <meta http-equiv="X-UA-Compatible" content="IE=edge">   
 <script src="/app.js"></script> 
<script src="http://code.highcharts.com/highcharts.js"></script>
<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'></script>
<script  type='text/javascript'>
//var chart;
var p = new Map([
	['01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	 ['q01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['q02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['q046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['w01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['w02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['w046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['e01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['e02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['e046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['r01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['r02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['r046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['t01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['t02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['t046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['y01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['y02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['y046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['u01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['u02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['u046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['i01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['i02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['i046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['o01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['o02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['o046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['p01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['p02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['p046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['a01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['a02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['a046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['s01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['s02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['s046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['d01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['d02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['d046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['f01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['f02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['f046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['g01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['g02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['g046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['h01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['h02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['h046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['j01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['j02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['j046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']],
	['k01c4a742660dbcfad307a4d87511258a', ['66', '#F44336', '6000000']],
	['k02de1a8e33fe808ef5fbb401d92f1bff', ['33','#2ecc71' ,'12000000']],
	['k046dea52b604fc657984cf7682969f31', ['100', '#34495e','18000000']] 
]);
	$(function() {


  var masterChart,
    detailChart;

  $(document).ready(function() {
	  console.log("hi");
	  function requestData() {
		  
	  $.ajax({
	
	type: 'GET',
	url: '/areachartjson', 
	contentType : "application/json",
	dataType: 'json',
	success: function() 
	{	
	
		var alerts=[];
        var colors=[];
        var data=[];
        var diff=[];
        p.forEach(function(value, key, map) {
            alerts.push(key);
            colors.push(value[1]);
            data.push(parseInt(value[0], 10));
            diff.push(parseInt(value[2], 10));
        });
    // create the master chart
    function createMaster() {
    	
      masterChart = new Highcharts.Chart({
        chart: {
          renderTo: 'master-container',
          reflow: false,
          borderWidth: 0,
          backgroundColor: null,
          marginLeft: 50,
          marginRight: 20,
          zoomType: 'x',
          events: {
            click: function(event) {
              var extremesObject = event.xAxis[0].value,
                min = extremesObject - 3,
                max = extremesObject + 3,
                detailData = [],
                xAxis = this.xAxis[0],
                detailColors=[],
                detailDiff=[],
                detailAlerts=[];

              // reverse engineer the last part of the data
              jQuery.each(this.series[0].data, function(i, point) {
                if (point.x > min && point.x < max) {
                	detailData.push(point.y);
                    detailColors.push(colors[this.series.data.indexOf( point )]);
                    detailAlerts.push(alerts[this.series.data.indexOf( point )]);
                    detailDiff.push(diff[this.series.data.indexOf( point )]);
                    
                }
              });
				
              // move the plot bands to reflect the new detail span
              xAxis.removePlotBand('mask-before');
              xAxis.addPlotBand({
                id: 'mask-before',
                from:0,
                to: min,
                color: 'rgba(0, 0, 0, 0.2)'
              });

              xAxis.removePlotBand('mask-after');
              xAxis.addPlotBand({
                id: 'mask-after',
                from: max,
                to: data.length,
                color: 'rgba(0, 0, 0, 0.2)'
              });
              detailChart.xAxis[0].setCategories(detailAlerts);
              detailChart.update({
              	colors: detailColors,	
              	tooltip: 
                	{
                        enabled:true,
                       formatter: function ()
                       {	
                    	   var difference = detailDiff[this.series.data.indexOf( this.point )];
    	            	 var minutesDifference = Math.floor(difference/1000/60);
    	            	 return 'Run Time = ' +minutesDifference+ 'mins';
                       }
                	}
       			});

              detailChart.series[0].setData(detailData);

              return false;
            },
            // listen to the selection event on the master chart to update the
            // extremes of the detail chart
            selection: function(event) {
              var extremesObject = event.xAxis[0],
                min = extremesObject.min,
                max = extremesObject.max,
                detailData = [],
                xAxis = this.xAxis[0],
                detailColors=[],
                detailDiff=[],
                detailAlerts=[];

              // reverse engineer the last part of the data
              jQuery.each(this.series[0].data, function(i, point) {
                if (point.x > min && point.x < max) {
                  detailData.push(point.y);
                  detailColors.push(colors[this.series.data.indexOf( point )]);
                  detailAlerts.push(alerts[this.series.data.indexOf( point )]);
                  detailDiff.push(diff[this.series.data.indexOf(point )]);
                }
              });

              // move the plot bands to reflect the new detail span
              xAxis.removePlotBand('mask-before');
              xAxis.addPlotBand({
                id: 'mask-before',
                from: 0,
                to: min,
                color: 'rgba(0, 0, 0, 0.2)'
              });

              xAxis.removePlotBand('mask-after');
              xAxis.addPlotBand({
                id: 'mask-after',
                from: max,
                to: data.length - 1,
                color: 'rgba(0, 0, 0, 0.2)'
              });
              detailChart.xAxis[0].setCategories(detailAlerts);
              detailChart.update({
              	colors: detailColors,
              	tooltip: 
                {
                        enabled:true,
                       formatter: function ()
                       {	
                    	   var difference = detailDiff[this.series.data.indexOf( this.point )];
    	            	 var minutesDifference = Math.floor(difference/1000/60);
    	            	 return 'Run Time = ' +minutesDifference+ 'mins';
                       }
                }
              	
       });
              detailChart.series[0].setData(detailData);
              return false;
            }
          }
        },
        plotOptions: {
          series: {
            colorByPoint: true,

          }
        },colors:colors,
        title: {
          text: null
        },
        xAxis: {
          categories: alerts,
          labels: {
              enabled: false
            }
        },
        yAxis: {
          gridLineWidth: 0,
          minorGridLineWidth: 0,
          labels: {
            enabled: false
          },
          title: {
            enabled: false
          },
        },
        tooltip: {
          enabled: false
        },
        legend: {
          enabled: false
        },
        credits: {
          enabled: false
        },

        series: [{
          type: 'bar',
          data: data
        }],

      }, function(masterChart) {
        createDetail(masterChart)
      });
    }

    // create the detail chart
    function createDetail(masterChart) {

      var detailData = [],
      detailColors=[],
      detailAlerts=[],
      detailDiff=[];

      jQuery.each(masterChart.series[0].data, function(i, point) {
        detailData.push(point.y);
        detailColors.push(point.color);
        detailDiff.push(diff[point.index])
        detailAlerts.push(alerts[point.index]);
      });
      
	

      detailChart = new Highcharts.Chart({
        chart: {
          type: 'bar',
          marginBottom: 120,
          renderTo: 'detail-container',
          reflow: false,
          marginLeft: 250,
          marginRight: 20,
          style: {
            position: 'absolute'
          }
        },
        credits: {
          enabled: false
        },
        legend: {
          enabled: false
        },
        tooltip: {
          /* enabled: true,
          formatter: function() {
            var difference = diff[this.series.data.indexOf(this.point)];
            var minutesDifference = Math.floor(difference / 1000 / 60);
            return 'Run Time = ' + minutesDifference + 'mins';
          } */
        },
        title: {
          text: ''
        },
        xAxis: {
          categories: detailAlerts
        },
        yAxis: {
          gridLineWidth: 0,
          minorGridLineWidth: 0
        },
        plotOptions: {
          series: {
            colorByPoint: true,
            pointWidth: 25,
            animation: true
          },
          bar: {
            dataLabels: {
              enabled: true,
              formatter: function() {

                if (this.y > 0) {
                  return Highcharts.numberFormat(this.y, 0) + "%";
                }
              }
            }
          }
        },
        colors: detailColors,
        series: [{
          name: 'Errors',
          data: detailData
        }]
      });
    }

    // make the container smaller and add a second container for the master chart


    // create master and in its callback, create the detail chart
    createMaster();
    
  }
	  });
		  }
	  console.log("j");
	  requestData();
	  setTimeout(requestData, 50000);
  });  

});
/* 
	$(document).ready(function() {
		var chart = new Highcharts.Chart({
            chart: {
                type: 'bar',
                renderTo : 'container',
                events : 
                {
                    load : function() 
                    {	
                    	console.log("hi2");
                    	function requestData() {
                    		console.log("hi3");
                    		$.ajax({
                    			
                    			type: 'GET',
                    			url: '/userchartjson', 
                    			contentType : "application/json",
                    			dataType: 'json',
                    			success: function(barChartMAp) 
                    			{	
                                        var alerts=[];
                                        var colors=[];
                                        var data=[];
                                        var diff=[];
                                        barChartMAp.forEach(function(value, key, map) {
                                            alerts.push(key);
                                            colors.push(value[1]);
                                            data.push(parseInt(value[0], 10));
                                            diff.push(parseInt(value[2], 10));
                                        });
                                        chart.series[0].setData(data);
                                        chart.xAxis[0].setCategories(alerts);
                                        chart.update({
                                        	colors: colors,	
                                        	tooltip: 
                                        {
                                                enabled:true,
                                               formatter: function ()
                                               {	console.log(diff[1]);
                                            	   var difference = diff[this.series.data.indexOf( this.point )];
                            	            	 var minutesDifference = Math.floor(difference/1000/60);
                            	            	 return 'Run Time = ' +minutesDifference+ 'mins';
                                               }
                                        }
                                 });
                                        chart.redraw();
                                	 setTimeout(requestData, 50000);
                    			},
                    			cache: false
                    		});
                    	}
                        requestData();
                    }
                }
            },
            title: {
		        text: 'Error Metrics'
		    },
		    
		    xAxis: {
		        categories: []
		                
		    },
		    yAxis: {
		        max: 100,
		        title: false,
		        plotBands: [{
		            from: 0,
		            to: 33,
		            color: "#FFEBEE"
		        }, {
		            from: 33,
		            to: 66,
		            color: '#FFFDE7'
		        }, {
		            from: 66,
		            to: 100,
		            color: '#E8F5E9'
		        }],
		        gridLineWidth: 0,
	            minorGridLineWidth: 0,
		    },
		    plotOptions: {
		            series: {
		            colorByPoint: true,
		            pointWidth: 25,
		            animation:true
		        },
		        bar: {
		            dataLabels: {
		                enabled:true,
		              formatter: function () {
		                    
		                                    if(this.y>0){
		                        return Highcharts.numberFormat(this.y,0)+"%";
		                  }
		              }
		            }
	            }
		    },colors:[],
		    
		    credits: {
		        enabled: false
		    },
		    series: [{
		        name: "Error",
		        data: []
		        
		    }]
        });
});	
 */

</script>
</head>
<body>
 <div id="detail-container" style="width: 1200px; height: 700px; float:left; margin_right:2px;"></div>
<div id="master-container" style="width: 120px; height: 700px;float:left; margin_right:5px;"></div>


 <h1></h1>
</body>
</html>
